<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
      <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body>  
    <div class="bg-[#537D5D] w-full h-screen pt-28 lg:pt-40">
        <div class="flex justify-center lg:text-5xl px-10 text-[#FFFFFF] font-bold ">
            <h5>Modern Farming Solutions</h5>
        </div>
        <div class="flex justify-center lg:text-2xl text-center lg:px-44 px-10 mt-5 text-[#F0F7D2] text-xl " >
           An integrated platform to help farmers increase yields, get the best seed recommendations, detect plant diseases, and connect with the market.
        </div>
        <div class="w-full flex justify-center items-center">
            <button class="h-8 lg:w-[16%] w-2/5 text-center text-[#537D5D] font-bold rounded-md bg-white mt-5 shadow-md shadow-gray-600">
                Get Started
            </button>
        </div>
        <div class="flex justify-between ">
            <div><img src="../static/flower.png" class="-scale-x-100" alt=""></div>
            <div><img src="../static/flower.png"  alt=""></div>
        </div>
    </div>
    <div class="lg:h-auto h-fit py-10 flex justify-center">
        <div class=" mx-10">
            <div class="flex justify-center text-3xl text-[#537D5D] font-bold ">
                <h5>Main Feature</h5>
            </div>
            <div class="flex justify-center text-center px-8 mt-5 text-xl  text-gray-600" >
                Improve your agricultural productivity with the latest technology
            </div>
            <div class="h-32 rounded-2xl bg-white mt-5 lg:mt-10 shadow-md shadow-gray-600">
                <div class="flex w-full h-full justify-center lg:justify-start lg:pl-10 items-center gap-x-5">
                    <div >
                        <img src="../static/chart.png" class="w-7 h-7 lg:w-10 lg:h-10" alt="">
                    </div>
                    <div class="w-3/4 ">
                        <div class="flex text-lg lg:text-2xl  text-[#537D5D] font-semibold ">
                            <h5>Main Feature</h5>
                        </div>
                        <div class=" text-xs lg:text-base text-gray-600">
                            Get the latest information on monthly harvest price trends with easy-to-understand visualizations. Plan your harvest time properly to maximize profits.
                        </div>
                    </div>
                </div>
            </div>
            <div class="h-32 rounded-2xl bg-white mt-5 lg:mt-10 shadow-md shadow-gray-600">
                <div class="flex w-full h-full justify-center lg:justify-start lg:pl-10 items-center gap-x-5">
                    <div >
                        <img src="../static/hand_plant.png" class="w-7 h-7 lg:w-10 lg:h-10" alt="">
                    </div>
                    <div class="w-3/4 ">
                        <div class="flex text-lg lg:text-2xl  text-[#537D5D] font-semibold ">
                            <h5>Best Seed Recommendations</h5>
                        </div>
                        <div class=" text-xs lg:text-base text-gray-600">
                            Our intelligent system will recommend the best seeds based on region, resources, and weather forecasts for up to one year ahead.
                        </div>
                    </div>
                </div>
            </div>
            <div class="h-32 rounded-2xl bg-white mt-5 lg:mt-10 shadow-md shadow-gray-600">
                <div class="flex w-full h-full justify-center lg:justify-start lg:pl-10 items-center gap-x-5">
                    <div >
                        <img src="../static/find.png" class="w-7 h-7 lg:w-10 lg:h-10" alt="">
                    </div>
                    <div class="w-3/4 ">
                        <div class="flex text-lg lg:text-2xl  text-[#537D5D] font-semibold ">
                            <h5>Plant Disease Detection</h5>
                        </div>
                        <div class=" text-xs lg:text-base text-gray-600">
                            Upload photos of your crops and our AI system will detect diseases and provide treatment recommendations.
                        </div>
                    </div>
                </div>
            </div>
            <div class="h-32 rounded-2xl bg-white mt-5 lg:mt-10 shadow-md shadow-gray-600">
                <div class="flex w-full h-full justify-center lg:justify-start lg:pl-10 items-center gap-x-5">
                    <div >
                        <img src="../static/chat.png" class="w-7 h-7 lg:w-10 lg:h-10" alt="">
                    </div>
                    <div class="w-3/4 ">
                        <div class="flex text-lg lg:text-2xl  text-[#537D5D] font-semibold ">
                            <h5>Chatbot & Market</h5>
                        </div>
                        <div class=" text-xs lg:text-base text-gray-600">
                            Ask our chatbot anything about farming and sell your harvest directly on our online market.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="h-fit py-10 bg-[#537D5D] pl-10 pr-32 lg:flex lg:justify-between">
    <div class="mb-8 lg:w-[25%]">
        <div class="mb-4 text-2xl font-semibold underline text-white">Si Panen</div>
        <div class=" text-white">A modern agriculture platform to increase productivity and the welfare of Indonesian farmers.</div>
    </div>
    <div class="mb-8 ">
        <div class="mb-4 text-2xl font-semibold underline text-white">Si Panen</div>
        <div class=" text-white">
            <ul>Harvest Price Trends</ul>
            <ul>Best Seed Recomendations</ul>
            <ul>Plant Disease Detection</ul>
            <ul>Chatbot & Market</ul>
        </div>
    </div>
    <div class="mb-8">
        <div class="mb-4 text-2xl font-semibold underline text-white">Help</div>
        <div class=" text-white">
            <ul>FAQ</ul>
            <ul>User Guides</ul>
            <ul>Contact Us</ul>
            <ul>Privacy Policy</ul>
        </div>
    </div>
    <div class="mb-8">
        <div class="mb-4 text-2xl font-semibold underline text-white">Contact</div>
        <div class=" text-white">
            <ul>FAQ</ul>
            <ul>User Guides</ul>
            <ul>Contact Us</ul>
            <ul>Privacy Policy</ul>
        </div>
    </div>
</div>

<!-- Sticky Chat Button and Chat Box Wrapper -->
<div class="fixed bottom-5 right-5 z-50 flex flex-col items-end gap-2">
    <!-- Chat Box -->
    <div id="chatBox" class="hidden w-[400px] h-[440px] bg-white shadow-lg rounded-lg border border-gray-300 flex flex-col">
        <div class="bg-[#537D5D] text-white px-4 py-2 font-semibold rounded-t-lg">
            Chat with us
        </div>
        <div id="chatMessages" class="flex-1 p-4 overflow-y-auto text-sm space-y-2 text-gray-700">
            <!-- Messages will appear here -->
        </div>
        <div class="p-2 border-t border-gray-300">
            <form id="chatForm" class="flex gap-2">
                <textarea id="chatInput" placeholder="Type your message..."  class="w-full resize-none px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring focus:border-blue-300"></textarea>
                <button type="submit" class="px-3 py-2 bg-[#537D5D] text-white rounded hover:bg-[#42624a]">Send</button>
            </form>
        </div>
    </div>

    <!-- Chat Toggle Button -->
    <button id="chatToggleBtn" class="w-14 h-14 bg-[#537D5D] text-white rounded-full shadow-lg flex items-center justify-center hover:bg-[#42624a]">
        ðŸ’¬
    </button>
</div>

<script>
    const chatBox = document.getElementById('chatBox');
    const chatToggleBtn = document.getElementById('chatToggleBtn');
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');

    let conversationHistory = [];

    // Toggle chat box
    chatToggleBtn.addEventListener('click', () => {
        chatBox.classList.toggle('hidden');
        if (chatBox.classList.contains('hidden')) {
            conversationHistory = []; // Optional: clear conversation when closed
        }
    });

    // Handle form submission
    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (!message) return;

        appendMessage(message, 'user');
        conversationHistory.push({ role: 'user', content: message });
        chatInput.value = '';
        chatInput.style.height = 'auto';
        chatMessages.scrollTop = chatMessages.scrollHeight;

        const prompt = conversationHistory.map(msg => 
            `${msg.role === 'user' ? "User" : "Assistant"}: ${msg.content}`
        ).join('\n') + '\nAssistant:';

        try {
            const response = await fetch('https://flask-api-vercel-test-eight.vercel.app/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: prompt })
            });

            const result = await response.json();
            const rawText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response.";
            const cleaned = rawText
                .replace(/```(json)?|```/g, '')
                .trim();

            appendMessage(cleaned, 'bot');
            conversationHistory.push({ role: 'bot', content: cleaned });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        } catch (error) {
            console.error(error);
            appendMessage("Error contacting server. Please try again later.", 'bot');
        }
    });

    // Append message to chat
    function appendMessage(text, sender) {
        const wrapper = document.createElement('div');
        wrapper.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'} mb-2`;

        const formattedText = text
            .replace(/\*\*\*(.+?)\*\*\*/g, '<b><i>$1</i></b>')
            .replace(/\*\*(.+?)\*\*/g, '<b>$1</b>')
            .replace(/\*(.+?)\*/g, '<i>$1</i>')
            .replace(/\\n|\n/g, '<br>');

        const bubble = document.createElement('div');
        bubble.className = `max-w-[75%] px-4 py-2 rounded-xl shadow whitespace-pre-wrap break-words 
            ${sender === 'user' 
                ? 'bg-[#DCF8C6] text-right rounded-br-none' 
                : 'bg-[#F1F0F0] text-left rounded-bl-none'
            }`;
        bubble.innerHTML = formattedText;

        wrapper.appendChild(bubble);
        chatMessages.appendChild(wrapper);
    }

    // Handle Shift+Enter for new line, Enter to submit
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            chatForm.dispatchEvent(new Event('submit'));
        }
    });

    // Auto resize textarea
    chatInput.addEventListener('input', () => {
        chatInput.style.height = 'auto';
        chatInput.style.height = `${chatInput.scrollHeight}px`;
    });
</script>



</body>
</html>
